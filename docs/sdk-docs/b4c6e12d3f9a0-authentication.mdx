---
title: "Authentication"
icon: "lock"
---
<Note>
The <code>connect</code> function and related authentication flow are scheduled to be released in a future version of the SDK.

This documentation describes features that may not yet be available in your current version.
</Note>

The [`connect` function](./api/@smokeballdev/namespaces/auth/interfaces/Api) is used to authenticate with Smokeball and generate a token session for your application.

The token session provides access to short-lived access tokens that can be used to make API requests to the Smokeball API with the scopes you have configured in your Smokeball App.

## Prerequisites

### 1. Initialize the SDK

Before using the `connect` function, you must initialize the SDK. The Client ID is obtained from your Smokeball App configuration. 

<Note>
Only applications that have been configured and approved by Smokeball can utilize this authentication functionality. 

If your application does not have a Client ID provided by Smokeball, you will not be able to use the `connect` function.
</Note>
```javascript
import { SmokeballClientSdk } from '@smokeballdev/smokeball-client-sdk';

const sdk = SmokeballClientSdk.get();
 
// Initialize with your Client ID
await sdk.init(); 
```

### 2. Obtain an Embed Token from your Backend

Your backend will receive a **nonce embed token** from Smokeball (for example, through a plugin pre-flight request). This embed token:

- Has a lifetime of **1 minute**
- Is tied to the logged-in user ID
- Is tied to your integrating app's Client ID

<Note>
Your backend should provide this token to your client application.
</Note>

## Using the Connect function

Once you have:
1. Initialized the SDK
2. Obtained an embed token from your backend

You can call the `connect` function:
```javascript
const tokenSession = await sdk.auth.connect({
  token: embedToken
});
```
The `connect` function accepts a request object with the following structure:
```javascript
{
  token: string  // The embed token received from your backend
}
```

### Response

The `connect` function returns a **token session** that exposes a `token()` function. This token session:

- Lasts for **1 day** regardless of refresh token lifetime, requiring a new session to be generated everytime your app is loaded
- Provides access to short-lived access tokens scoped to your app's Client ID and configured scopes

The token session object has the following structure:

```javascript
{
  token: () => Promise<string>;  // Function to acquire a new short-lived access token
}
```

### Getting Access Tokens

Use the `token()` function from the token session to acquire a new short-lived access token:

```javascript
// Get a new access token
const accessToken = await tokenSession.token();

// Use the access token in API requests
const response = await fetch('https://api.smokeball.com/firm', {
  headers: {
    'Authorization': `Bearer ${accessToken}`
  }
});
```

<Note>
The refresh token and refresh functionality are handled automatically by the SDK backend. You do not need to manage refresh tokens directly.
</Note>

### Complete Example

```javascript
import { SmokeballClientSdk } from '@smokeballdev/smokeball-client-sdk';

// Get the SDK instance
const sdk = SmokeballClientSdk.get();

// Step 1: Initialize
await sdk.init();

// Step 2: Connect using the embed token to create a token session
try {
  const tokenSession = await sdk.auth.connect({
    token: embedToken
  });
  
  // Step 4: Use the token session to get access tokens
  // The token session lasts for 1 day
  const accessToken = await tokenSession.accessToken();
  
  console.log('Access Token:', accessToken);
  
  // Use the access token to make API requests
  const apiResponse = await fetch('https://api.smokeball.com/v1/endpoint', {
    headers: {
      'Authorization': `Bearer ${accessToken}`
    }
  });
  
  // Get a new access token when needed (the SDK handles refresh automatically)
  const newAccessToken = await tokenSession.accessToken();
  
} catch (error) {
  console.error('Connect failed:', error);
}
```

## Notes
- The Client ID is obtained from your Smokeball App configuration in the Developer Console.
- The embed token is received by your backend from Smokeball (for example, through a plugin pre-flight request).
- The embed token has a 1-minute lifetime and must be used promptly.
- The token session created by `connect` lasts for exactly 1 day, after which you must generate a new session.
- Access tokens obtained via `accessToken()` are short-lived and scoped to your app's Client ID and configured scopes.
- Refresh token management is handled automatically by the SDK.

